<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.care.library.admin.AdminMapper">
	<resultMap type="com.care.library.member.MemberDTO" id="memberDto"> <!-- id는 식별자일뿐 -->
  		<result column = "pro_name" property = "proName"/>
  		<result column = "detail_address" property = "detailAddress"/>
  		<result column = "reg_date" property = "regDate"/>
  		<result column = "post_code" property = "postCode"/>
  		<result column = "auth_date" property = "authDate"/>
  		<result column = "user_group" property = "userGroup"/>
  	</resultMap>
  	<resultMap type="com.care.library.user.InquiryDTO" id="inquiryDto">
  		<result column = "write_date" property = "writeDate"/>
  		<result column = "reply_content" property = "replyContent"/>
  	</resultMap>
  	
  	<select id = "count">
  		SELECT count(id) FROM member
  	</select>

  	<select id = "countUser">
  		SELECT count(id) FROM member WHERE status = #{memberSelect}
  	</select>
	
	<select id = "selectMember" resultMap="memberDto">
		SELECT BBB.* FROM (SELECT rownum as rn, AAA.* FROM (SELECT * FROM member WHERE status = #{memberSelect} ORDER BY auth_date ASC)AAA)BBB WHERE BBB.rn BETWEEN #{begin} AND #{end}
	</select>
	
	<select id = "selectAllMember" resultMap="memberDto">
		SELECT BBB.* FROM (SELECT rownum as rn, AAA.* FROM (SELECT * FROM member ORDER BY reg_date ASC)AAA)BBB WHERE BBB.rn BETWEEN #{begin} AND #{end}
	</select>
	
	<select id = "countMember">
   	 	SELECT COUNT(id) FROM member WHERE ${searchSelect} like '%'||#{search}||'%'
	</select>

	<select id = "searchMember" resultMap="memberDto">
	    SELECT BBB.* FROM (SELECT rownum as rn, AAA.* FROM (SELECT * FROM member WHERE ${searchSelect} like '%'||#{search}||'%' ORDER BY reg_date ASC)AAA)BBB WHERE BBB.rn BETWEEN #{begin} AND #{end}
	</select>
	
	<select id ="countMemberDiv">
	    SELECT count(id) FROM member WHERE status = #{memberSelect} AND ${searchSelect} LIKE '%'||#{search}||'%'
	</select>
	
	<select id="searchMemberDiv" resultMap="memberDto">
	    SELECT BBB.* FROM (SELECT rownum as rn, AAA.* FROM (SELECT * FROM member WHERE status = #{memberSelect} AND ${searchSelect} LIKE '%'||#{search}||'%' ORDER BY reg_date ASC)AAA)BBB WHERE BBB.rn BETWEEN #{begin} AND #{end}
	</select>
	
	<select id = "selectUser" resultMap="memberDto">
		SELECT * FROM member WHERE id = #{id}
	</select>
	
	<update id = "memberConfirm" parameterType="com.care.library.member.MemberDTO">
		UPDATE member SET status = 'A', user_group = #{userGroup}, paper = #{paper}, auth_date = #{authDate} WHERE id = #{id}
	</update>
	
	<update id = "memberReject">
		UPDATE member SET status = 'D', reject = #{reject} WHERE id = #{id}
	</update>

	<select id="countInquiry">
		SELECT count(no) FROM inquiry
	</select>
	
	<select id="selectInquiry" resultMap="inquiryDto">
		SELECT BBB.* FROM (SELECT rownum as rn, AAA.* FROM(SELECT * FROM inquiry ORDER BY no DESC)AAA)BBB WHERE BBB.rn BETWEEN #{begin} AND #{end}
	</select>

	<select id="countInquiryReply">
		SELECT count(no) FROM inquiry WHERE reply = #{replySelect}
	</select>

	<select id="selectInquiryReply" resultMap="inquiryDto">
		SELECT BBB.* FROM(SELECT rownum as rn, AAA.* FROM (SELECT * FROM inquiry WHERE reply = #{replySelect} ORDER BY no DESC)AAA)BBB WHERE BBB.rn BETWEEN #{begin} AND #{end}
	</select>

	<select id="countInquiryTitle">
		SELECT count(no) FROM inquiry WHERE title like '%'||#{search}||'%'
	</select>

	<select id="selectInquiryTitle">
		SELECT BBB.* FROM (SELECT rownum as rn, AAA.* FROM (SELECT * FROM inquiry WHERE title like '%'||#{search}||'%' ORDER BY no DESC)AAA)BBB WHERE BBB.rn BETWEEN #{begin} AND #{end}
	</select>

	<select id="countInquiryWriter">
		SELECT count(no) FROM inquiry WHERE id like '%'||#{search}||'%'
	</select>
	
	<select id="selectInquiryWriter">
		SELECT BBB.* FROM (SELECT rownum as rn, AAA.* FROM (SELECT * FROM inquiry WHERE id like '%'||#{search}||'%' ORDER BY no DESC)AAA)BBB WHERE BBB.rn BETWEEN #{begin} AND #{end}
	</select>

	<select id="selectInquiryContent" resultMap="inquiryDto">
		SELECT * FROM inquiry WHERE no=#{no}
	</select>

	<update id ="replyWrite">
		UPDATE inquiry SET reply_content = #{content}, reply = 'Y' WHERE no = #{no}
	</update>
</mapper>



  